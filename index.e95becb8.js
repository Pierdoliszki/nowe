!function(t){"use strict";var i=Modernizr.cssanimations,e={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Modernizr.prefixed("animation")];function s(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e]);return t}function n(t,i){this.el=t,this.options=s({},this.options),s(this.options,i),this.items=[].slice.call(this.el.children),this.itemsTotal=this.items.length,(this.options.infinite&&this.options.visible>=this.itemsTotal||!this.options.infinite&&this.options.visible>this.itemsTotal||this.options.visible<=0)&&(this.options.visible=1),this.current=0,this._init()}n.prototype.options={perspective:1e3,perspectiveOrigin:"50% -50%",visible:3,infinite:!0,onEndStack:function(){return!1},stackItemsAnimation:{duration:500,type:dynamics.bezier,points:[{x:0,y:0,cp:[{x:.25,y:.1}]},{x:1,y:1,cp:[{x:.25,y:1}]}]},stackItemsAnimationDelay:0},n.prototype._init=function(){this.el.style.WebkitPerspective=this.el.style.perspective=this.options.perspective+"px",this.el.style.WebkitPerspectiveOrigin=this.el.style.perspectiveOrigin=this.options.perspectiveOrigin;for(var t=0;t<this.itemsTotal;++t){var i=this.items[t];t<this.options.visible?(i.style.opacity=1,i.style.pointerEvents="auto",i.style.zIndex=0===t?parseInt(this.options.visible+1):parseInt(this.options.visible-t),i.style.WebkitTransform=i.style.transform="translate3d(0px, 0px, "+parseInt(-50*t)+"px)"):i.style.WebkitTransform=i.style.transform="translate3d(0,0,-"+parseInt(50*this.options.visible)+"px)"}classie.add(this.items[this.current],"stack__item--current")},n.prototype.reject=function(t){this._next("reject",t)},n.prototype.accept=function(t){this._next("accept",t)},n.prototype.restart=function(){this.hasEnded=!1,this._init()},n.prototype._next=function(t,s){if(!(this.isAnimating||!this.options.infinite&&this.hasEnded)){this.isAnimating=!0;var n=this.items[this.current];classie.remove(n,"stack__item--current"),classie.add(n,"accept"===t?"stack__item--accept":"stack__item--reject");var o=this;!function(t,s){var n=function(t){if(i){if(t.target!=this)return;this.removeEventListener(e,n)}s&&"function"==typeof s&&s.call()};i?t.addEventListener(e,n):n()}(n,(function(){n.style.opacity=0,n.style.pointerEvents="none",n.style.zIndex=-1,n.style.WebkitTransform=n.style.transform="translate3d(0px, 0px, -"+parseInt(50*o.options.visible)+"px)",classie.remove(n,"accept"===t?"stack__item--accept":"stack__item--reject"),o.items[o.current].style.zIndex=o.options.visible+1,o.isAnimating=!1,s&&s(),o.options.infinite||0!==o.current||(o.hasEnded=!0,o.options.onEndStack(o))}));for(var r=0;r<this.itemsTotal&&!(r>=this.options.visible);++r){if(this.options.infinite)a=this.current+r<this.itemsTotal-1?this.current+r+1:r-(this.itemsTotal-this.current-1);else{if(this.current+r>=this.itemsTotal-1)break;var a=this.current+r+1}var c=this.items[a],p=function(t,i){t.style.pointerEvents="auto",t.style.opacity=1,t.style.zIndex=parseInt(o.options.visible-i),dynamics.animate(t,{translateZ:parseInt(-50*i)},o.options.stackItemsAnimation)};setTimeout(function(i,e){return function(){var s;if(o.options.stackItemsPreAnimation&&(s="accept"===t?o.options.stackItemsPreAnimation.accept:o.options.stackItemsPreAnimation.reject),s){var n={};for(var r in s.animationProperties){var a=s.elastic?s.animationProperties[r]/o.options.visible:0;n[r]=s.animationProperties[r]-Number(e*a)}n.translateZ=parseInt(-50*(e+1)),s.animationSettings.complete=function(){p(i,e)},dynamics.animate(i,n,s.animationSettings)}else p(i,e)}}(c,r),this.options.stackItemsAnimationDelay)}this.current=this.current<this.itemsTotal-1?this.current+1:0,classie.add(this.items[this.current],"stack__item--current")}},t.Stack=n}(window);